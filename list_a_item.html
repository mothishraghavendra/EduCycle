<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List a New Item - Educycle</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Cloudinary Upload Widget -->
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
    <!-- Tagify CSS and JS for tech stack selection -->
    <link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f3f3f3;
            color: #333;
            padding: 20px;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Main Content */
        .main-content {
            max-width: 1000px; /* Increased from 800px */
            margin: 0 auto;
            padding: 20px;
        }

        /* Page Header */
        .page-header {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }

        .page-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .page-subtitle {
            color: #666;
            font-size: 1rem;
        }

        /* Form Container */
        .form-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-icon {
            color: #1e3a8a;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .required {
            color: #dc3545;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background-color: #fff;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff9900;
            box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            background-color: #fff;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #ff9900;
            box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #ff9900;
            box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
        }

        .form-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #ff9900;
            background-color: #fff8f0;
        }

        .radio-option.selected {
            border-color: #ff9900;
            background-color: #fff8f0;
        }

        .radio-input {
            display: none;
        }

        .radio-label {
            font-weight: 500;
            color: #333;
        }

        /* Price sections */
        .price-section {
            display: none;
            margin-top: 15px;
        }

        .price-section.show {
            display: block;
        }

        .free-indicator {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            border: 1px solid #c3e6cb;
        }

        /* Image Upload Grid */
        .image-upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .image-upload-box {
            position: relative;
            aspect-ratio: 1;
            border: 3px dashed #ccc;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
            overflow: hidden;
        }

        .image-upload-box:hover {
            border-color: #ff9900;
            background: #fff8f0;
        }

        .image-upload-box.has-image {
            border-style: solid;
            border-color: #28a745;
            background: white;
        }

        .upload-icon {
            font-size: 2.5rem;
            color: #999;
            margin-bottom: 10px;
        }

        .upload-text {
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .upload-subtext {
            font-size: 0.9rem;
            color: #999;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .image-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
        }

        .remove-image {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 1rem;
            z-index: 10;
        }

        .remove-image:hover {
            background: #dc3545;
        }

        /* Submit Button */
        .submit-section {
            text-align: center;
            margin-top: 30px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #ff9900, #ff7700);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 153, 0, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Dynamic Form Sections */
        .dynamic-section {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: all 0.5s ease;
            margin-bottom: 0;
        }

        .dynamic-section.show {
            opacity: 1;
            max-height: 3000px; /* Increased for mobile */
            margin-bottom: 30px; /* Ensure proper spacing */
        }

        /* Software specific styling */
        .software-highlight {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        .software-highlight h4 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        /* Tagify customization */
        .tagify {
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            padding: 8px;
            min-height: 45px;
        }

        .tagify:focus-within {
            border-color: #ff9900;
            box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.1);
        }

        .tagify__tag {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px;
            padding: 4px 12px;
            margin: 2px;
            font-size: 0.85rem;
        }

        .tagify__tag:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
        }

        .tagify__input {
            color: #333;
            font-size: 1rem;
        }

        /* Software category section */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .category-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .category-option:hover {
            border-color: #ff9900;
            background-color: #fff8f0;
        }

        .category-option.selected {
            border-color: #ff9900;
            background-color: #fff8f0;
        }

        .category-icon {
            font-size: 1.2rem;
            color: #007bff;
        }

        .url-input-group {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .url-input-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .url-prefix {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 50px;
            height: 50px;
            color: #666;
            font-size: 24px;
            flex-shrink: 0;
        }

        .url-input {
            flex: 1;
            padding: 12px 16px;
            width: 100%;
            min-width: 300px;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px; /* Minimal body padding on mobile */
            }
            
            .main-content {
                padding: 2px; /* Reduced padding for maximum width */
                max-width: 100%; /* Full width on mobile for better utilization */
                margin: 0; /* Remove default margin */
            }
            
            .form-container {
                padding: 8px; /* Reduced padding for more space */
                margin: 0; /* Remove auto margin for full width */
                border-radius: 4px; /* Smaller radius for mobile */
            }
            
            .page-header {
                padding: 15px 8px; /* Reduced padding for mobile */
                margin-bottom: 8px; /* Reduced margin */
            }
            
            .page-title {
                font-size: 1.4rem; /* Slightly smaller for mobile */
            }
            
            .page-subtitle {
                font-size: 0.9rem; /* Smaller subtitle */
            }
            
            .form-section {
                margin-bottom: 20px; /* Reduced margin for mobile */
            }
            
            .section-title {
                font-size: 1.1rem; /* Slightly smaller section titles */
                margin-bottom: 12px; /* Reduced margin */
            }
            
            .form-group {
                margin-bottom: 15px; /* Reduced margin between form groups */
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .image-upload-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .two-column {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .three-column {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .category-grid {
                grid-template-columns: repeat(2, 1fr); /* Two columns on mobile for better space utilization */
                gap: 8px; /* Compact spacing for mobile */
                max-width: 100%;
                overflow: visible; /* Ensure all categories are visible */
                margin-top: 15px; /* Add some margin for mobile */
                margin-bottom: 25px; /* Extra bottom margin to prevent overlap */
                padding: 0; /* Remove any padding */
            }

            .category-option {
                padding: 12px 8px; /* Compact padding for mobile */
                min-height: 55px; /* Optimized height for mobile */
                display: flex;
                align-items: center;
                text-align: left;
                font-size: 0.85rem; /* Slightly smaller text for mobile */
                word-wrap: break-word;
                border-radius: 6px;
                border: 2px solid #e1e5e9; /* Ensure border is visible */
                background: white; /* Ensure background */
                cursor: pointer;
            }

            .category-option:hover, .category-option.selected {
                border-color: #ff9900;
                background-color: #fff8f0;
            }

            .category-icon {
                font-size: 1.1rem; /* Slightly smaller icon for mobile */
                margin-right: 8px; /* Reduced margin */
                margin-bottom: 0;
                flex-shrink: 0;
                min-width: 20px; /* Ensure consistent icon width */
                color: #007bff; /* Ensure icon color */
            }
            
            /* Ensure software fields don't overlap with sale type section */
            .dynamic-section.show {
                margin-bottom: 40px; /* Extra spacing on mobile */
                padding-bottom: 20px; /* Additional padding */
            }
            
            /* Ensure software category section has proper spacing */
            #softwareFields .form-group:last-child {
                margin-bottom: 30px; /* Extra margin for last form group */
            }

            /* Make URL input fields shorter on mobile */
            .url-input {
                width: 75vw;
                max-width: 300px;
                min-width: 200px;
            }
        }

        /* Tablet responsive */
        @media (max-width: 1024px) and (min-width: 769px) {
            .main-content {
                max-width: 95%;
                padding: 20px;
            }
            
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .category-option {
                padding: 15px;
                min-height: 60px;
            }
        }

        /* Large screens */
        @media (min-width: 1200px) {
            .main-content {
                max-width: 1200px; /* Increased width for large screens */
            }
            
            .category-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="main-content">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">List a New Item</h1>
            <p class="page-subtitle">Share your academic essentials with junior students and help them save money!</p>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="listItemForm">
                <!-- Basic Information Section -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="bi bi-info-circle section-icon"></i>
                        Basic Information
                    </h2>
                    
                    <div class="form-group">
                        <label for="itemName" class="form-label">Item Name <span class="required">*</span></label>
                        <input type="text" id="itemName" name="itemName" class="form-input" placeholder="e.g., Calculus Textbook 10th Edition" required>
                        <div class="form-help">Enter a clear, descriptive name for your item</div>
                    </div>

                    <div class="form-group">
                        <label for="category" class="form-label">Category <span class="required">*</span></label>
                        <select id="category" name="category" class="form-select" required onchange="handleCategoryChange()">
                            <option value="">Select a category</option>
                            <option value="calculator">Calculator</option>
                            <option value="hardware">Electronics</option>
                            <option value="software">Software & Digital</option>
                            <option value="drafting-items">Stationery</option>
                            <option value="textbooks">Textbooks</option>
                            <option value="study-materials">Study Materials</option>
                            <option value="other">Other</option>
                        </select>
                        <div class="form-help">Choose the category that best describes your item</div>
                    </div>

                    <!-- Standard fields for non-software items -->
                    <div id="standardFields">
                        <div class="form-group">
                            <label for="condition" class="form-label">Condition <span class="required">*</span></label>
                            <select id="condition" name="condition" class="form-select" required>
                                <option value="">Select condition</option>
                                <option value="New">New - Like new, never used</option>
                                <option value="Like New">Like New - Excellent condition, barely used</option>
                                <option value="Good">Good - Normal wear, fully functional</option>
                                <option value="Fair">Fair - Some wear, still functional</option>
                                <option value="Poor">Poor - Heavy wear, functional but shows age</option>
                            </select>
                            <div class="form-help">Honestly describe the condition of your item</div>
                        </div>

                        <div class="form-group">
                            <label for="description" class="form-label">Description <span class="required">*</span></label>
                            <textarea id="description" name="description" class="form-textarea" placeholder="Describe your item's condition, features, and any important details..." required></textarea>
                            <div class="form-help">Provide detailed information about your item's condition and features</div>
                        </div>
                    </div>

                    <!-- Software-specific fields -->
                    <div id="softwareFields" class="dynamic-section">
                        <div class="software-highlight">
                            <h4><i class="bi bi-code-slash"></i> Software/Digital Product Information</h4>
                            <p>Fill in the details below to showcase your software or digital tool to the community.</p>
                        </div>

                        <!-- Basic Software Info -->
                        <div class="form-group">
                            <label for="softwareDescription" class="form-label">Description <span class="required">*</span></label>
                            <textarea id="softwareDescription" name="softwareDescription" class="form-textarea" placeholder="What does your software do? Who does it help? What are the key features?" required></textarea>
                            <div class="form-help">Explain what your software does, who it helps, and key features</div>
                        </div>

                        <div class="form-group">
                            <label for="tagline" class="form-label">Tagline</label>
                            <input type="text" id="tagline" name="tagline" class="form-input" placeholder="A catchy one-liner about your software" maxlength="500">
                            <div class="form-help">Short, memorable description (max 500 characters)</div>
                        </div>

                        <!-- Platform and Technical Details -->
                        <div class="two-column">
                            <div class="form-group">
                                <label for="platform" class="form-label">Platform <span class="required">*</span></label>
                                <select id="platform" name="platform" class="form-select" required>
                                    <option value="">Select platform</option>
                                    <option value="Web">Web</option>
                                    <option value="Android">Android</option>
                                    <option value="iOS">iOS</option>
                                    <option value="Windows">Windows</option>
                                    <option value="Mac">Mac</option>
                                    <option value="Linux">Linux</option>
                                    <option value="Cross-platform">Cross-platform</option>
                                    <option value="Desktop">Desktop</option>
                                    <option value="Mobile">Mobile</option>
                                </select>
                                <div class="form-help">Which platforms does it run on?</div>
                            </div>

                            <div class="form-group">
                                <label for="version" class="form-label">Version</label>
                                <input type="text" id="version" name="version" class="form-input" placeholder="e.g., 1.0.0, 2.1.3" value="1.0.0">
                                <div class="form-help">Current version of your software</div>
                            </div>
                        </div>

                        <!-- Tech Stack with Tagify -->
                        <div class="form-group">
                            <label for="techStack" class="form-label">Tech Stack</label>
                            <input id="techStack" name="techStack" class="form-input" placeholder="Enter technologies used">
                            <div class="form-help">Programming languages, frameworks, and tools used</div>
                        </div>

                        <!-- Developer and License Info -->
                        <div class="two-column">
                            <div class="form-group">
                                <label for="developerName" class="form-label">Developer Name</label>
                                <input type="text" id="developerName" name="developerName" class="form-input" placeholder="Your name or team name">
                                <div class="form-help">Credit to the student who built it (auto-filled from your profile)</div>
                            </div>

                            <div class="form-group">
                                <label for="licenseType" class="form-label">License Type</label>
                                <select id="licenseType" name="licenseType" class="form-select">
                                    <option value="">Select license</option>
                                    <option value="MIT">MIT</option>
                                    <option value="GPL v3">GPL v3</option>
                                    <option value="Apache 2.0">Apache 2.0</option>
                                    <option value="BSD">BSD</option>
                                    <option value="Freeware">Freeware</option>
                                    <option value="Open Source">Open Source</option>
                                    <option value="Custom">Custom</option>
                                    <option value="Proprietary">Proprietary</option>
                                </select>
                                <div class="form-help">How others can use your software</div>
                            </div>
                        </div>

                        <!-- Links Section -->
                        <div class="form-group">
                            <label class="form-label">Links & Resources</label>
                            <div style="margin-top: 10px; display: grid; gap: 15px;">
                                <div class="url-input-group">
                                    <div class="form-help">Direct download link (Google Drive, GitHub, etc.)</div>
                                    <div class="url-input-row">
                                        <span class="url-prefix"><i class="fa fa-download" style="font-size:24px"></i></span>
                                        <input type="url" id="downloadLink" name="downloadLink" class="form-input url-input" placeholder="https://drive.google.com/... or https://github.com/...">
                                    </div>
                                </div>
                                
                                <div class="url-input-group">
                                    <div class="form-help">Live demo or video demonstration</div>
                                    <div class="url-input-row">
                                        <span class="url-prefix"><i class="fa fa-play-circle-o" style="font-size:24px"></i></span>
                                        <input type="url" id="demoLink" name="demoLink" class="form-input url-input" placeholder="https://yourapp.com or https://youtu.be/...">
                                    </div>
                                </div>
                                
                                <div class="url-input-group">
                                    <div class="form-help">GitHub repository (if open source)</div>
                                    <div class="url-input-row">
                                        <span class="url-prefix"><i class="fa fa-github" style="font-size:24px"></i></span>
                                        <input type="url" id="githubLink" name="githubLink" class="form-input url-input" placeholder="https://github.com/yourusername/project">
                                    </div>
                                </div>
                                
                                <div class="url-input-group">
                                    <div class="form-help">Documentation or user guide</div>
                                    <div class="url-input-row">
                                        <span class="url-prefix"><i class="fa fa-file-text" style="font-size:24px"></i></span>
                                        <input type="url" id="documentationLink" name="documentationLink" class="form-input url-input" placeholder="https://docs.yourproject.com">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Features -->
                        <div class="form-group">
                            <label for="features" class="form-label">Key Features</label>
                            <textarea id="features" name="features" class="form-textarea" placeholder=" Feature 1&#10; Feature 2&#10; Feature 3" rows="4"></textarea>
                            <div class="form-help">List the main features (one per line with bullet points)</div>
                        </div>

                        <!-- System Requirements -->
                        <div class="form-group">
                            <label for="systemRequirements" class="form-label">System Requirements</label>
                            <textarea id="systemRequirements" name="systemRequirements" class="form-textarea" placeholder=" OS: Windows 10/11, macOS 10.15+, Ubuntu 18.04+&#10; RAM: 4GB minimum, 8GB recommended&#10; Storage: 500MB free space&#10; Other: Node.js 16+, Python 3.8+" rows="4"></textarea>
                            <div class="form-help">Minimum system requirements to run your software</div>
                        </div>

                        <!-- Software Category Selection -->
                        <div class="form-group">
                            <label class="form-label">Software Category <span class="required">*</span></label>
                            <div class="category-grid" id="softwareCategoryGrid">
                                <!-- Categories will be populated here -->
                            </div>
                            <input type="hidden" id="selectedCategory" name="selectedCategory" required>
                            <div class="form-help">Select the category that best describes your software</div>
                        </div>

                        <!-- Contact Support -->
                        <div class="form-group">
                            <label for="contactSupport" class="form-label">Contact / Support</label>
                            <input type="text" id="contactSupport" name="contactSupport" class="form-input" placeholder="Email or contact info for support/collaboration">
                            <div class="form-help">How users can reach you for support or collaboration (auto-filled from your profile)</div>
                        </div>
                    </div>
                </div>

                <!-- Sale Type Section -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="bi bi-tag section-icon"></i>
                        Sale Type & Pricing
                    </h2>
                    
                    <div class="form-group">
                        <label class="form-label">Sale Type <span class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option" onclick="selectSaleType('donation')">
                                <input type="radio" id="donation" name="saleType" value="donation" class="radio-input" required>
                                <label for="donation" class="radio-label">
                                    <i class="bi bi-heart"></i> Donation (Free)
                                </label>
                            </div>
                            <div class="radio-option" onclick="selectSaleType('discounted')">
                                <input type="radio" id="discounted" name="saleType" value="discounted" class="radio-input" required>
                                <label for="discounted" class="radio-label">
                                    <i class="bi bi-tag"></i> Discounted Sale
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Price Section (hidden by default) -->
                    <div class="price-section" id="priceSection">
                        <div class="form-group">
                            <label for="price" class="form-label">Price <span class="required">*</span></label>
                            <input type="number" id="price" name="price" class="form-input" placeholder="Enter price in ₹" min="0" step="0.01">
                            <div class="form-help">Enter your asking price in Indian Rupees</div>
                        </div>
                    </div>

                    <!-- Free Indicator (hidden by default) -->
                    <div class="price-section" id="freeSection">
                        <div class="free-indicator">
                            <i class="bi bi-heart-fill"></i> FREE - Thank you for your generosity!
                        </div>
                    </div>
                </div>

                <!-- Images Section -->
                <div class="form-section">
                    <h2 class="section-title">
                        <i class="bi bi-camera section-icon"></i>
                        <span id="imagesSectionTitle">Item Photos</span>
                    </h2>
                    <div class="form-help" style="margin-bottom: 15px;" id="imagesHelpText">Add up to 3 photos of your item. Good photos help buyers understand the condition and details.</div>
                    
                    <div class="image-upload-grid">
                        <!-- Image 1 -->
                        <div class="image-upload-box" onclick="triggerCloudinaryUpload(1)">
                            <i class="bi bi-camera upload-icon"></i>
                            <div class="upload-text" id="uploadText1">Main Photo</div>
                            <div class="upload-subtext">Click to upload</div>
                            <button type="button" class="remove-image" onclick="removeCloudinaryImage(1, event)" style="display: none;">×</button>
                            <input type="file" id="image1" name="image1" class="file-input" accept="image/*" style="display: none;">
                            <img id="preview1" class="image-preview" style="display: none;">
                        </div>
                        
                        <!-- Image 2 -->
                        <div class="image-upload-box" onclick="triggerCloudinaryUpload(2)">
                            <i class="bi bi-camera upload-icon"></i>
                            <div class="upload-text" id="uploadText2">Photo 2</div>
                            <div class="upload-subtext">Optional</div>
                            <button type="button" class="remove-image" onclick="removeCloudinaryImage(2, event)" style="display: none;">×</button>
                            <input type="file" id="image2" name="image2" class="file-input" accept="image/*" style="display: none;">
                            <img id="preview2" class="image-preview" style="display: none;">
                        </div>
                        
                        <!-- Image 3 -->
                        <div class="image-upload-box" onclick="triggerCloudinaryUpload(3)">
                            <i class="bi bi-camera upload-icon"></i>
                            <div class="upload-text" id="uploadText3">Photo 3</div>
                            <div class="upload-subtext">Optional</div>
                            <button type="button" class="remove-image" onclick="removeCloudinaryImage(3, event)" style="display: none;">×</button>
                            <input type="file" id="image3" name="image3" class="file-input" accept="image/*" style="display: none;">
                            <img id="preview3" class="image-preview" style="display: none;">
                        </div>
                    </div>
                </div>

                <div class="submit-section">
                    <button type="submit" class="submit-btn">
                        <i class="bi bi-check-circle"></i> List Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Global variables for software categories and tagify
        let techStackTagify = null;
        let softwareCategories = [];
        let cloudinaryConfig = null;
        let cloudinaryWidget = null;
        let uploadedImages = {}; // Store Cloudinary URLs

        // Tech stack whitelist for Tagify
        const techStackWhitelist = [
            // Programming Languages
            "Python", "JavaScript", "Java", "C++", "C#", "PHP", "TypeScript", "Go", "Rust", "Swift", "Kotlin", "Dart", "Ruby", "Scala", "R", "MATLAB", "Perl", "Shell", "PowerShell",
            
            // Frontend Frameworks & Libraries
            "React", "Vue.js", "Angular", "Next.js", "Nuxt.js", "Svelte", "jQuery", "Bootstrap", "Tailwind CSS", "Material-UI", "Ant Design", "Chakra UI", "Semantic UI",
            
            // Backend Frameworks
            "Node.js", "Express.js", "Django", "Flask", "FastAPI", "Spring Boot", "Laravel", "ASP.NET", "Ruby on Rails", "Phoenix", "Gin", "Fiber", "Nest.js",
            
            // Mobile Development
            "React Native", "Flutter", "Ionic", "Xamarin", "Cordova", "NativeScript", "Expo", "Kotlin Multiplatform",
            
            // Databases
            "MySQL", "PostgreSQL", "MongoDB", "SQLite", "Redis", "Firebase", "Supabase", "MariaDB", "Oracle", "SQL Server", "DynamoDB", "Cassandra", "Neo4j",
            
            // Cloud & DevOps
            "AWS", "Azure", "Google Cloud", "Docker", "Kubernetes", "Jenkins", "GitLab CI", "GitHub Actions", "Terraform", "Ansible", "Vagrant",
            
            // AI/ML & Data Science
            "TensorFlow", "PyTorch", "Scikit-learn", "OpenCV", "Pandas", "NumPy", "Matplotlib", "Seaborn", "Jupyter", "Keras", "NLTK", "spaCy",
            
            // Game Development
            "Unity", "Unreal Engine", "Godot", "Phaser", "Cocos2d", "GameMaker",
            
            // Desktop Development
            "Electron", "Qt", "Tkinter", "PyQt", "WPF", "WinUI", "GTK", "JavaFX",
            
            // Tools & Others
            "Git", "Webpack", "Vite", "Babel", "ESLint", "Prettier", "Jest", "Cypress", "Selenium", "Postman", "Figma", "Adobe XD"
        ];

        // Load Cloudinary configuration
        async function loadCloudinaryConfig() {
            try {
                const response = await fetch('/api/config');
                const data = await response.json();
                if (data.success && data.cloudinary) {
                    cloudinaryConfig = data.cloudinary;
                    console.log('☁️ Cloudinary configuration loaded:', cloudinaryConfig.cloudName);
                    initializeCloudinaryWidget();
                } else {
                    console.error('❌ Failed to load Cloudinary configuration');
                }
            } catch (error) {
                console.error('❌ Error loading Cloudinary configuration:', error);
            }
        }

        // Initialize Cloudinary Upload Widget
        function initializeCloudinaryWidget() {
            if (!cloudinaryConfig || !window.cloudinary) {
                console.error('❌ Cloudinary not available');
                return;
            }

            cloudinaryWidget = window.cloudinary.createUploadWidget({
                cloudName: cloudinaryConfig.cloudName,
                uploadPreset: cloudinaryConfig.uploadPreset,
                sources: ['local', 'camera'],
                multiple: false,
                maxFiles: 1,
                maxFileSize: 10000000, // 10MB
                maxImageWidth: 1920,
                maxImageHeight: 1080,
                cropping: false,
                showAdvancedOptions: false,
                showInsecurePreview: false,
                showUploadMoreButton: false,
                folder: 'educycle/products',
                publicId: null,
                transformation: [
                    { width: 800, height: 600, crop: 'limit' },
                    { quality: 'auto:good' },
                    { format: 'auto' }
                ]
            }, (error, result) => {
                if (!error && result && result.event === "success") {
                    console.log('✅ Image uploaded successfully:', result.info.secure_url);
                    handleCloudinaryUpload(result.info);
                } else if (error) {
                    console.error('❌ Cloudinary upload failed:', error);
                    alert('Failed to upload image. Please try again.');
                }
            });

            console.log('☁️ Cloudinary widget initialized');
        }

        // Handle successful Cloudinary upload
        function handleCloudinaryUpload(info) {
            const imageNumber = cloudinaryWidget.currentImageNumber;
            if (!imageNumber) {
                console.warn('No image number specified for upload');
                return;
            }

            console.log(`📷 Handling Cloudinary upload for image ${imageNumber}:`, info.secure_url);

            // Store the uploaded image URL
            uploadedImages[`image${imageNumber}`] = info.secure_url;

            // Find the elements using the existing structure
            const inputElement = document.getElementById(`image${imageNumber}`);
            const uploadBox = inputElement ? inputElement.closest('.image-upload-box') : null;
            const previewImg = document.getElementById(`preview${imageNumber}`);
            const uploadText = document.getElementById(`uploadText${imageNumber}`);
            
            if (uploadBox && previewImg && uploadText) {
                // Set the preview image
                previewImg.src = info.secure_url;
                previewImg.style.display = 'block';
                
                // Update the upload box to show it has an image
                uploadBox.classList.add('has-image');
                
                // Update the text to indicate it's a new image
                uploadText.textContent = `New ${imageNumber === 1 ? 'Main Photo' : `Photo ${imageNumber}`}`;
                uploadText.style.color = '#28a745'; // Green color for new uploads
                
                // Update the onclick to use triggerImageUpload for replacement
                uploadBox.setAttribute('onclick', `triggerImageUpload(${imageNumber})`);
                
                // Show the remove button
                const removeBtn = uploadBox.querySelector('.remove-image');
                if (removeBtn) {
                    removeBtn.style.display = 'block';
                    removeBtn.setAttribute('onclick', `removeUploadedImage(${imageNumber})`);
                }
                
                console.log(`✅ Image ${imageNumber} preview updated with new Cloudinary URL`);
            } else {
                console.warn(`⚠️ Could not find upload elements for image ${imageNumber}`);
            }
        }
        async function loadSoftwareCategories() {
            try {
                const response = await fetch('/api/software-categories');
                const data = await response.json();
                if (data.success && data.categories && data.categories.length > 0) {
                    softwareCategories = data.categories;
                    renderSoftwareCategories();
                    console.log('ðŸ“‚ Software categories loaded from API:', softwareCategories.length);
                } else {
                    console.error(' Failed to load software categories from API');
                    if (softwareCategories.length > 0) {
                        renderSoftwareCategories();
                    }
                }
            } catch (error) {
                console.error(' Error loading software categories:', error);
                if (softwareCategories.length > 0) {
                    renderSoftwareCategories();
                }
            }
        }

        // Fallback categories if API fails
        function loadDefaultCategories() {
            console.log('ðŸ”„ Loading default software categories...');
            
            softwareCategories = [
                { category_id: 1, name: 'Web Development', icon: 'bi-globe', description: 'Web applications and tools' },
                { category_id: 2, name: 'Mobile Development', icon: 'bi-phone', description: 'Mobile apps and development tools' },
                { category_id: 3, name: 'Desktop Applications', icon: 'bi-laptop', description: 'Desktop software and utilities' },
                { category_id: 4, name: 'Development Tools', icon: 'bi-code-slash', description: 'IDEs, editors, and development utilities' },
                { category_id: 5, name: 'Data Science', icon: 'bi-graph-up', description: 'Data analysis and machine learning tools' },
                { category_id: 6, name: 'Game Development', icon: 'bi-controller', description: 'Games and game development tools' },
                { category_id: 7, name: 'Productivity', icon: 'bi-briefcase', description: 'Office tools and productivity software' },
                { category_id: 8, name: 'Educational', icon: 'bi-book', description: 'Learning and educational software' },
                { category_id: 9, name: 'Graphics & Design', icon: 'bi-palette', description: 'Design and graphics software' },
                { category_id: 10, name: 'Security', icon: 'bi-shield-check', description: 'Security and privacy tools' },
                { category_id: 11, name: 'Utilities', icon: 'bi-gear', description: 'System utilities and tools' },
                { category_id: 12, name: 'Open Source', icon: 'bi-github', description: 'Open source projects' }
            ];
            
            console.log(`… Default categories loaded: ${softwareCategories.length} categories`);
            renderSoftwareCategories();
        }

        // Initialize Tagify for tech stack
        function initializeTechStack() {
            const techStackInput = document.getElementById('techStack');
            if (techStackInput && !techStackTagify) {
                techStackTagify = new Tagify(techStackInput, {
                    whitelist: techStackWhitelist,
                    maxTags: 10,
                    dropdown: {
                        maxItems: 20,
                        classname: "tags-look",
                        enabled: 0,
                        closeOnSelect: false
                    },
                    editTags: false,
                    placeholder: "Type to add technologies..."
                });

                console.log('ðŸ·ï¸ Tagify initialized for tech stack');
            }
        }

        // Global variables for edit mode
        let isEditMode = false;
        let editProductId = null;
        let editProductType = null;

        // Check if we're in edit mode based on URL parameters
        function checkEditMode() {
            const urlParams = new URLSearchParams(window.location.search);
            const editType = urlParams.get('edit');
            const productId = urlParams.get('id');

            if (editType && productId) {
                isEditMode = true;
                editProductId = productId;
                editProductType = editType;
                
                console.log(`🔧 Edit mode detected: ${editType} product ID ${productId}`);
                
                // Update page title and heading
                document.title = 'Edit Item - Educycle';
                const pageHeading = document.querySelector('h1');
                if (pageHeading) {
                    pageHeading.textContent = 'Edit Your Item';
                }
                
                // Update submit button text
                const submitBtn = document.querySelector('button[type="submit"]');
                if (submitBtn) {
                    submitBtn.innerHTML = '<i class="bi bi-check-circle"></i> Update Item';
                }
                
                // Load the product data
                if (editProductType === 'software') {
                    loadSoftwareForEdit();
                } else {
                    loadProductForEdit();
                }
            }
        }

        // Load regular product data for editing
        async function loadProductForEdit() {
            try {
                console.log(`🔄 Loading product data for editing (ID: ${editProductId})`);
                
                const response = await fetch(`/api/products/${editProductId}`);
                const data = await response.json();
                
                if (data.success) {
                    const product = data.product;
                    console.log('✅ Product data loaded:', product);
                    
                    // Fill form fields
                    document.getElementById('itemName').value = product.name || '';
                    document.getElementById('description').value = product.description || '';
                    document.getElementById('price').value = product.price || '';
                    document.getElementById('category').value = product.category || '';
                    document.getElementById('condition').value = product.condition_item || '';
                    
                    // Trigger change events to ensure proper validation
                    document.getElementById('category').dispatchEvent(new Event('change'));
                    
                    // Set donation/discounted based on price
                    if (product.price == 0) {
                        selectSaleType('donation');
                    } else {
                        selectSaleType('discounted');
                    }
                    
                    // Initialize uploadedImages with existing images for proper form submission
                    if (product.image1_url) uploadedImages.image1 = product.image1_url;
                    if (product.image2_url) uploadedImages.image2 = product.image2_url;
                    if (product.image3_url) uploadedImages.image3 = product.image3_url;
                    
                    // Show existing images with proper preview
                    initializeEditImagePreviews(product);
                    
                    console.log('✅ Regular product form populated successfully');
                    console.log('📷 UploadedImages initialized:', uploadedImages);
                    
                } else {
                    console.error('❌ Failed to load product:', data.message);
                    alert('Failed to load product data: ' + data.message);
                }
            } catch (error) {
                console.error('❌ Error loading product:', error);
                alert('Failed to load product data. Please try again.');
            }
        }

        // Load software product data for editing
        async function loadSoftwareForEdit() {
            try {
                console.log(`🔄 Loading software data for editing (ID: ${editProductId})`);
                
                const response = await fetch(`/api/software/${editProductId}/edit`);
                const data = await response.json();
                
                if (data.success) {
                    const software = data.software;
                    console.log('✅ Software data loaded:', software);
                    
                    // Set category to software first
                    document.getElementById('category').value = 'software';
                    handleCategoryChange(); // This will show software fields
                    
                    // Wait a bit for fields to be visible, then fill them
                    setTimeout(() => {
                        // Fill basic fields
                        document.getElementById('itemName').value = software.name || '';
                        document.getElementById('softwareDescription').value = software.description || '';
                        document.getElementById('price').value = software.price || '';
                        
                        // Fill software-specific fields
                        document.getElementById('tagline').value = software.tagline || '';
                        document.getElementById('platform').value = software.platform || '';
                        document.getElementById('techStack').value = software.tech_stack || '';
                        document.getElementById('developerName').value = software.developer_name || '';
                        document.getElementById('licenseType').value = software.license_type || '';
                        document.getElementById('version').value = software.version || '';
                        document.getElementById('downloadLink').value = software.download_link || '';
                        document.getElementById('demoLink').value = software.demo_link || '';
                        document.getElementById('githubLink').value = software.github_link || '';
                        document.getElementById('documentationLink').value = software.documentation_link || '';
                        
                        // Handle features (JSON array)
                        if (software.features) {
                            try {
                                const features = JSON.parse(software.features);
                                if (Array.isArray(features)) {
                                    features.forEach((feature, index) => {
                                        const featureInput = document.getElementById(`feature${index + 1}`);
                                        if (featureInput) {
                                            featureInput.value = feature;
                                        }
                                    });
                                }
                            } catch (e) {
                                console.warn('Could not parse features:', e);
                            }
                        }
                        
                        // Handle system requirements (JSON object)
                        if (software.system_requirements) {
                            try {
                                const sysReq = JSON.parse(software.system_requirements);
                                document.getElementById('minOs').value = sysReq.minOs || '';
                                document.getElementById('minRam').value = sysReq.minRam || '';
                                document.getElementById('minStorage').value = sysReq.minStorage || '';
                                document.getElementById('minProcessor').value = sysReq.minProcessor || '';
                            } catch (e) {
                                console.warn('Could not parse system requirements:', e);
                            }
                        }
                        
                        // Set donation/discounted based on price
                        if (software.price == 0) {
                            selectSaleType('donation');
                        } else {
                            selectSaleType('discounted');
                        }
                        
                        // Initialize uploadedImages with existing images for proper form submission
                        if (software.image1_url) uploadedImages.image1 = software.image1_url;
                        if (software.image2_url) uploadedImages.image2 = software.image2_url;
                        if (software.image3_url) uploadedImages.image3 = software.image3_url;
                        
                        // Show existing images with proper preview
                        initializeEditImagePreviews(software);
                        
                        console.log('✅ Software form populated successfully');
                        console.log('📷 UploadedImages initialized:', uploadedImages);
                        
                        // Set software category if available
                        // The API returns categories as an array of objects with name and icon
                        if (software.categories && software.categories.length > 0) {
                            const categoryName = software.categories[0].name; // Get the name from the first category
                            console.log('Setting software category:', categoryName);
                            
                            // Find and select the category
                            setTimeout(() => {
                                const categoryOptions = document.querySelectorAll('.category-option');
                                let categoryFound = false;
                                categoryOptions.forEach(option => {
                                    const optionText = option.textContent.trim();
                                    if (optionText.toLowerCase() === categoryName.toLowerCase()) {
                                        option.click(); // This will trigger the selection
                                        categoryFound = true;
                                        console.log('✅ Software category selected:', optionText);
                                    }
                                });
                                
                                if (!categoryFound) {
                                    console.warn('⚠️ Category not found, selecting first available:', categoryName);
                                    const firstCategory = document.querySelector('.category-option');
                                    if (firstCategory) {
                                        firstCategory.click();
                                    }
                                }
                            }, 200);
                        } else {
                            // Fallback: set a default category to avoid validation error
                            console.log('No categories found, selecting first available');
                            setTimeout(() => {
                                const firstCategory = document.querySelector('.category-option');
                                if (firstCategory) {
                                    firstCategory.click();
                                    console.log('✅ Default category selected');
                                }
                            }, 200);
                        }
                        
                        // Initialize tech stack tagify after setting value
                        initializeTechStack();
                        if (techStackTagify && software.tech_stack) {
                            techStackTagify.addTags(software.tech_stack.split(',').map(t => t.trim()));
                        }
                    }, 500);
                    
                } else {
                    console.error('❌ Failed to load software:', data.message);
                    alert('Failed to load software data: ' + data.message);
                }
            } catch (error) {
                console.error('❌ Error loading software:', error);
                alert('Failed to load software data. Please try again.');
            }
        }

        // Display existing images in the upload sections
        // Function to initialize image previews in edit mode
        function initializeEditImagePreviews(productData) {
            console.log('📷 Initializing edit image previews:', productData);
            
            for (let i = 1; i <= 3; i++) {
                const imageUrl = productData[`image${i}_url`];
                
                if (imageUrl) {
                    console.log(`📷 Setting up existing image ${i}:`, imageUrl);
                    
                    // Find the image upload box by finding the input element and getting its parent
                    const inputElement = document.getElementById(`image${i}`);
                    const uploadBox = inputElement ? inputElement.closest('.image-upload-box') : null;
                    const previewImg = document.getElementById(`preview${i}`);
                    const uploadText = document.getElementById(`uploadText${i}`);
                    
                    if (uploadBox && previewImg && uploadText) {
                        // Set the preview image
                        previewImg.src = imageUrl;
                        previewImg.style.display = 'block';
                        
                        // Update the upload box to show it has an image
                        uploadBox.classList.add('has-image');
                        
                        // Update the text to indicate it's an existing image
                        uploadText.textContent = `Current ${i === 1 ? 'Main Photo' : `Photo ${i}`}`;
                        
                        // Update the onclick to use triggerImageUpload instead of triggerCloudinaryUpload
                        uploadBox.setAttribute('onclick', `triggerImageUpload(${i})`);
                        
                        // Show the remove button
                        const removeBtn = uploadBox.querySelector('.remove-image');
                        if (removeBtn) {
                            removeBtn.style.display = 'block';
                            removeBtn.setAttribute('onclick', `removeUploadedImage(${i})`);
                        }
                        
                        console.log(`✅ Image ${i} preview set successfully`);
                    } else {
                        console.warn(`⚠️ Could not find upload elements for image ${i}`);
                    }
                }
            }
            
            console.log('📷 Image previews initialized for edit mode');
        }

        function displayExistingImages(imageUrls) {
            imageUrls.forEach((url, index) => {
                if (url) {
                    const uploadSection = document.getElementById(`upload${index + 1}`);
                    if (uploadSection) {
                        // Store the existing URL in a data attribute
                        uploadSection.setAttribute('data-existing-url', url);
                        
                        uploadSection.innerHTML = `
                            <div class="existing-image" style="position: relative; border: 2px solid #28a745; border-radius: 8px; padding: 10px; background-color: #f8fff8;">
                                <img src="${url}" alt="Current image ${index + 1}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                                <div style="text-align: center; margin-bottom: 10px;">
                                    <p style="color: #28a745; font-weight: bold; font-size: 0.9rem; margin: 0;"><i class="bi bi-check-circle"></i> Current Image ${index + 1}</p>
                                    <p style="color: #666; font-size: 0.8rem; margin: 5px 0 0 0;">Click below to replace with new image</p>
                                </div>
                                <button type="button" class="upload-btn" onclick="triggerImageUpload(${index + 1})" style="width: 100%; padding: 8px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9rem;">
                                    <i class="bi bi-cloud-upload"></i> Replace Image
                                </button>
                                <button type="button" onclick="removeExistingImage(${index + 1})" style="position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 0.8rem; display: flex; align-items: center; justify-content: center;">
                                    ×
                                </button>
                            </div>
                        `;
                    }
                }
            });
        }

        // Function to trigger image upload for replacement
        function triggerImageUpload(imageNumber) {
            // Store which image slot we're replacing
            if (cloudinaryWidget) {
                cloudinaryWidget.currentImageNumber = imageNumber;
                cloudinaryWidget.open();
                console.log(`📤 Opening Cloudinary widget for image slot ${imageNumber}`);
            } else {
                console.warn('Cloudinary widget not available');
                alert('Image upload not available. Please refresh the page and try again.');
            }
        }

        // Function to remove existing image
        function removeExistingImage(imageNumber) {
            const inputElement = document.getElementById(`image${imageNumber}`);
            const uploadBox = inputElement ? inputElement.closest('.image-upload-box') : null;
            const previewImg = document.getElementById(`preview${imageNumber}`);
            const uploadText = document.getElementById(`uploadText${imageNumber}`);
            
            if (uploadBox && previewImg && uploadText) {
                // Remove from uploadedImages
                delete uploadedImages[`image${imageNumber}`];
                
                // Hide the preview image
                previewImg.style.display = 'none';
                previewImg.src = '';
                
                // Remove the has-image class
                uploadBox.classList.remove('has-image');
                
                // Reset the text
                uploadText.textContent = imageNumber === 1 ? 'Main Photo' : `Photo ${imageNumber}`;
                
                // Reset the onclick to original function
                uploadBox.setAttribute('onclick', `triggerCloudinaryUpload(${imageNumber})`);
                
                // Hide the remove button
                const removeBtn = uploadBox.querySelector('.remove-image');
                if (removeBtn) {
                    removeBtn.style.display = 'none';
                }
                
                console.log(`🗑️ Removed image ${imageNumber} from upload queue`);
            }
        }

        // Function to remove uploaded images (same as removeExistingImage but with different naming for clarity)
        function removeUploadedImage(imageNumber) {
            removeExistingImage(imageNumber);
        }

        // Load user profile and auto-fill fields
        async function loadUserProfile() {
            try {
                const response = await fetch('/api/profile');
                const data = await response.json();
                if (data.success && data.user) {
                    const developerNameField = document.getElementById('developerName');
                    if (developerNameField && !developerNameField.value) {
                        developerNameField.value = data.user.username;
                    }
                    
                    const contactSupportField = document.getElementById('contactSupport');
                    if (contactSupportField && !contactSupportField.value) {
                        contactSupportField.value = data.user.email;
                    }
                    
                    console.log('ðŸ‘¤ User profile loaded and fields auto-filled');
                } else {
                    console.log('š ï¸ User profile not available');
                }
            } catch (error) {
                console.error(' Error loading user profile:', error);
            }
        }

        // Call on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Page loaded, initializing components...');
            loadCloudinaryConfig();
            loadUserProfile();
            loadDefaultCategories();
            loadSoftwareCategories();
            
            // Check if we're in edit mode
            checkEditMode();
            
            // Add event listeners to radio buttons
            const donationRadio = document.getElementById('donation');
            const discountedRadio = document.getElementById('discounted');
            
            if (donationRadio) {
                donationRadio.addEventListener('change', function() {
                    if (this.checked) {
                        selectSaleType('donation');
                    }
                });
            }
            
            if (discountedRadio) {
                discountedRadio.addEventListener('change', function() {
                    if (this.checked) {
                        selectSaleType('discounted');
                    }
                });
            }
            
            console.log('✅ Initialization complete');
        });

        // Handle category change to show/hide software fields
        function handleCategoryChange() {
            const category = document.getElementById('category').value;
            const standardFields = document.getElementById('standardFields');
            const softwareFields = document.getElementById('softwareFields');
            const imagesSectionTitle = document.getElementById('imagesSectionTitle');
            const imagesHelpText = document.getElementById('imagesHelpText');
            const uploadText1 = document.getElementById('uploadText1');
            const uploadText2 = document.getElementById('uploadText2');
            const uploadText3 = document.getElementById('uploadText3');

            console.log('ðŸ”„ Category changed to:', category);

            if (category === 'software') {
                console.log('ðŸ’» Showing software fields and categories...');
                
                standardFields.style.display = 'none';
                softwareFields.classList.add('show');
                
                imagesSectionTitle.textContent = 'Screenshots / Demo Images';
                imagesHelpText.textContent = 'Add screenshots or demo images to help users preview your software. You can also include a demo video link in the fields above.';
                uploadText1.textContent = 'Screenshot 1';
                uploadText2.textContent = 'Screenshot 2';
                uploadText3.textContent = 'Screenshot 3';

                document.getElementById('softwareDescription').setAttribute('required', 'required');
                document.getElementById('platform').setAttribute('required', 'required');
                document.getElementById('selectedCategory').setAttribute('required', 'required');

                document.getElementById('condition').removeAttribute('required');
                document.getElementById('description').removeAttribute('required');

                setTimeout(() => {
                    initializeTechStack();
                }, 100);

                setTimeout(() => {
                    renderSoftwareCategories();
                }, 300);

            } else {
                console.log('ðŸ“ Showing standard fields, hiding software section...');
                
                standardFields.style.display = 'block';
                softwareFields.classList.remove('show');
                
                imagesSectionTitle.textContent = 'Item Photos';
                imagesHelpText.textContent = 'Add up to 3 photos of your item. Good photos help buyers understand the condition and details.';
                uploadText1.textContent = 'Main Photo';
                uploadText2.textContent = 'Photo 2';
                uploadText3.textContent = 'Photo 3';

                document.getElementById('condition').setAttribute('required', 'required');
                document.getElementById('description').setAttribute('required', 'required');

                document.getElementById('softwareDescription').removeAttribute('required');
                document.getElementById('platform').removeAttribute('required');
                document.getElementById('selectedCategory').removeAttribute('required');
            }
        }

        // Render software categories
        function renderSoftwareCategories() {
            const categoryGrid = document.getElementById('softwareCategoryGrid');
            if (!categoryGrid) {
                console.error(' Software category grid not found');
                return;
            }

            categoryGrid.innerHTML = '';
            
            if (!softwareCategories || softwareCategories.length === 0) {
                console.warn('š ï¸ No software categories to render');
                categoryGrid.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #666; padding: 20px;">Loading categories...</div>';
                return;
            }

            console.log(`ðŸ“‚ Rendering ${softwareCategories.length} software categories for mobile/desktop`);
            
            categoryGrid.innerHTML = softwareCategories.map(category => `
                <div class="category-option" data-category-id="${category.category_id}" data-category-name="${category.name}">
                    <i class="${category.icon} category-icon"></i>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 500; font-size: 0.9rem; word-wrap: break-word;">${category.name}</div>
                        <div style="font-size: 0.75rem; color: #666; line-height: 1.2; margin-top: 2px; word-wrap: break-word;">${category.description || ''}</div>
                    </div>
                </div>
            `).join('');
            
            document.querySelectorAll('.category-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectSoftwareCategory(this.dataset.categoryId, this.dataset.categoryName);
                });
            });
            
            console.log('… Software categories rendered successfully');
        }

        // Select software category
        function selectSoftwareCategory(categoryId, categoryName) {
            document.querySelectorAll('.category-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            const clickedOption = document.querySelector(`[data-category-id="${categoryId}"]`);
            if (clickedOption) {
                clickedOption.classList.add('selected');
            }
            
            document.getElementById('selectedCategory').value = categoryId;
            console.log('ðŸ“‚ Software category selected:', categoryName);
        }

        // Sale type selection
        function selectSaleType(type) {
            console.log('🏷️ Selecting sale type:', type);
            
            // Remove selected class from all options
            document.querySelectorAll('.radio-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Add selected class to the clicked option
            const clickedOption = document.querySelector(`.radio-option[onclick="selectSaleType('${type}')"]`);
            if (clickedOption) {
                clickedOption.classList.add('selected');
            }
            
            // Set the radio button as checked
            const radioButton = document.getElementById(type);
            if (radioButton) {
                radioButton.checked = true;
                console.log('✅ Radio button checked:', type);
            }
            
            // Handle price section visibility
            const priceSection = document.getElementById('priceSection');
            const freeSection = document.getElementById('freeSection');
            
            if (type === 'donation') {
                priceSection.classList.remove('show');
                freeSection.classList.add('show');
                const priceInput = document.getElementById('price');
                if (priceInput) {
                    priceInput.removeAttribute('required');
                    priceInput.value = ''; // Clear price
                }
                console.log('💝 Donation selected - price not required');
            } else {
                priceSection.classList.add('show');
                freeSection.classList.remove('show');
                const priceInput = document.getElementById('price');
                if (priceInput) {
                    priceInput.setAttribute('required', 'required');
                }
                console.log('💰 Discounted sale selected - price required');
            }
        }

        // Navigation function to go back to My Items
        function navigateBack() {
            if (window.parent && window.parent !== window) {
                window.parent.postMessage({
                    type: 'navigate',
                    page: 'myitems.html'
                }, '*');
            } else {
                window.history.back();
            }
        }

        // Image upload functions
        function triggerFileInput(number) {
            triggerCloudinaryUpload(number);
        }

        // Trigger Cloudinary upload
        function triggerCloudinaryUpload(number) {
            if (!cloudinaryWidget) {
                console.error('❌ Cloudinary widget not initialized');
                alert('Image upload service is not ready. Please refresh the page.');
                return;
            }

            // Store the current image number for the callback
            cloudinaryWidget.currentImageNumber = number;
            cloudinaryWidget.open();
        }

        // Remove Cloudinary image
        function removeCloudinaryImage(number, event) {
            event.stopPropagation();
            
            // Remove from uploaded images
            delete uploadedImages[`image${number}`];
            
            const uploadBox = document.querySelector(`#image${number}`).parentElement;
            const photoText = number === 1 ? 'Main Photo' : `Photo ${number}`;
            
            uploadBox.innerHTML = `
                <i class="bi bi-camera upload-icon"></i>
                <div class="upload-text">${photoText}</div>
                <div class="upload-subtext">${number === 1 ? 'Click to upload' : 'Optional'}</div>
                <button type="button" class="remove-image" onclick="removeCloudinaryImage(${number}, event)" style="display: none;">×</button>
                <input type="file" id="image${number}" name="image${number}" class="file-input" accept="image/*" style="display: none;">
            `;
            uploadBox.classList.remove('has-image');
            uploadBox.setAttribute('onclick', `triggerCloudinaryUpload(${number})`);
            
            console.log(`🗑️ Image ${number} removed`);
        }

        // Helper function to get image URLs (now returns Cloudinary URLs)
        function getImageData(number) {
            // First check if there's a newly uploaded image
            const newImageUrl = uploadedImages[`image${number}`];
            if (newImageUrl) {
                return newImageUrl;
            }
            
            // Then check if there's an existing image (for edit mode)
            const uploadSection = document.getElementById(`upload${number}`);
            if (uploadSection) {
                const existingImageUrl = uploadSection.getAttribute('data-existing-url');
                if (existingImageUrl) {
                    return existingImageUrl;
                }
            }
            
            return null;
        }

        // Form submission handler
        document.getElementById('listItemForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            console.log('🚀 Starting form submission...');

            // Get basic form values
            const saleType = document.querySelector('input[name="saleType"]:checked')?.value;
            const category = document.getElementById('category').value;
            const itemName = document.getElementById('itemName').value.trim();

            // Basic validation
            if (!saleType) {
                alert('Please select a sale type (Donation or Discounted Sale)');
                return;
            }

            if (!category) {
                alert('Please select a category');
                return;
            }

            if (!itemName) {
                alert('Please enter an item name');
                return;
            }

            // Category-specific validation
            let description, condition, platform, selectedCategory;

            if (category === 'software') {
                // Software product validation
                description = document.getElementById('softwareDescription').value.trim();
                platform = document.getElementById('platform').value;
                selectedCategory = document.getElementById('selectedCategory').value;

                if (!description) {
                    alert('Please provide a description for your software');
                    return;
                }

                if (!platform) {
                    alert('Please select a platform for your software');
                    return;
                }

                if (!selectedCategory) {
                    alert('Please select a software category');
                    return;
                }

                console.log('✅ Software product validation passed');
            } else {
                // Regular product validation
                description = document.getElementById('description').value.trim();
                condition = document.getElementById('condition').value;

                if (!description) {
                    alert('Please provide a description for your item');
                    return;
                }

                if (!condition) {
                    alert('Please select the condition of your item');
                    return;
                }

                console.log('✅ Regular product validation passed');
            }

            // Price validation
            const price = saleType === 'donation' ? 0 : parseFloat(document.getElementById('price').value);
            if (saleType === 'discounted' && (!price || price <= 0)) {
                alert('Please enter a valid price for discounted sale');
                return;
            }

            // Collect image URLs (Cloudinary URLs)
            const imageUrls = {};
            for (let i = 1; i <= 3; i++) {
                const imageUrl = getImageData(i);
                if (imageUrl) {
                    imageUrls[`image${i}`] = imageUrl;
                }
            }

            console.log(`📸 Found ${Object.keys(imageUrls).length} images to submit:`, imageUrls);

            try {
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Submitting...';
                submitBtn.disabled = true;

                // Prepare form data based on category
                let formData = {
                    name: itemName,
                    category,
                    saleType,
                    price,
                    imageUrls
                };

                if (category === 'software') {
                    // Get tech stack from Tagify
                    const techStackValue = techStackTagify ? 
                        techStackTagify.value.map(tag => tag.value).join(', ') : 
                        document.getElementById('techStack').value;
                    
                    // Add software-specific fields
                    formData = {
                        ...formData,
                        description,
                        tagline: document.getElementById('tagline').value.trim(),
                        platform,
                        version: document.getElementById('version').value.trim() || '1.0.0',
                        techStack: techStackValue,
                        developerName: document.getElementById('developerName').value.trim(),
                        licenseType: document.getElementById('licenseType').value,
                        downloadLink: document.getElementById('downloadLink').value.trim(),
                        demoLink: document.getElementById('demoLink').value.trim(),
                        githubLink: document.getElementById('githubLink').value.trim(),
                        documentationLink: document.getElementById('documentationLink').value.trim(),
                        features: document.getElementById('features').value.trim(),
                        systemRequirements: document.getElementById('systemRequirements').value.trim(),
                        categoryId: selectedCategory,
                        contactSupport: document.getElementById('contactSupport').value.trim(),
                        condition: 'New' // Default for software
                    };
                } else {
                    // Add regular product fields
                    formData = {
                        ...formData,
                        description,
                        condition
                    };
                }

                console.log('📤 Submitting form data:', formData);

                // Define productType for use in both success and error cases
                const productType = category === 'software' ? 'software' : 'item';

                let response, result;

                // Choose endpoint based on edit mode
                if (isEditMode) {
                    console.log(`🔧 Updating ${editProductType} product (ID: ${editProductId})`);
                    
                    if (editProductType === 'software') {
                        // Update software product
                        response = await fetch(`/api/software/${editProductId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: formData.name,
                                description: formData.description,
                                tagline: formData.tagline,
                                price: formData.price,
                                image1_url: formData.imageUrls.image1 || null,
                                image2_url: formData.imageUrls.image2 || null,
                                image3_url: formData.imageUrls.image3 || null,
                                platform: formData.platform,
                                tech_stack: formData.techStack,
                                developer_name: formData.developerName,
                                license_type: formData.licenseType,
                                version: formData.version,
                                download_link: formData.downloadLink,
                                demo_link: formData.demoLink,
                                github_link: formData.githubLink,
                                documentation_link: formData.documentationLink,
                                features: formData.features ? formData.features.split('\n').filter(f => f.trim()) : [],
                                system_requirements: {
                                    minOs: document.getElementById('minOs')?.value || '',
                                    minRam: document.getElementById('minRam')?.value || '',
                                    minStorage: document.getElementById('minStorage')?.value || '',
                                    minProcessor: document.getElementById('minProcessor')?.value || ''
                                },
                                categories: formData.categoryId ? [document.querySelector(`#softwareCategories .category-option[data-category-id="${formData.categoryId}"]`)?.textContent?.trim()] : []
                            })
                        });
                    } else {
                        // Update regular product
                        response = await fetch(`/api/products/${editProductId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                name: formData.name,
                                description: formData.description,
                                price: formData.price,
                                category: formData.category,
                                condition: formData.condition,
                                image1_url: formData.imageUrls.image1 || null,
                                image2_url: formData.imageUrls.image2 || null,
                                image3_url: formData.imageUrls.image3 || null
                            })
                        });
                    }
                } else {
                    // Create new product
                    response = await fetch('/api/add-product-direct', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                }

                result = await response.json();
                console.log('📨 Server response:', result);

                // Restore button
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;

                if (result.success) {
                    const imageCount = Object.keys(imageUrls).length;
                    const imageText = imageCount > 0 ? ` with ${imageCount} image(s)` : '';
                    const actionText = isEditMode ? 'updated' : 'listed';
                    
                    alert(`${productType} ${actionText} successfully${imageText}! You will be redirected to your items page.`);

                    // Navigate back to My Items
                    if (window.parent && window.parent !== window) {
                        window.parent.postMessage({
                            type: 'navigate',
                            page: 'myitems.html'
                        }, '*');
                    } else {
                        window.location.href = 'myitems.html';
                    }
                } else {
                    console.error('❌ Submission failed:', result.message);
                    const actionText = isEditMode ? 'update' : 'add';
                    if (response.status === 401) {
                        alert(`Please log in to ${actionText} items`);
                        if (window.parent && window.parent !== window) {
                            window.parent.postMessage({
                                type: 'navigate',
                                page: 'login.html'
                            }, '*');
                        } else {
                            window.location.href = 'login.html';
                        }
                    } else {
                        alert(`Failed to ${actionText} ${productType}: ${result.message}`);
                    }
                }

            } catch (error) {
                console.error('💥 Submission error:', error);
                alert('Error submitting form: ' + error.message);
                
                // Restore button on error
                const submitBtn = this.querySelector('button[type="submit"]');
                const buttonText = isEditMode ? '<i class="bi bi-check-circle"></i> Update Item' : '<i class="bi bi-check-circle"></i> List Item';
                submitBtn.innerHTML = buttonText;
                submitBtn.disabled = false;
            }
        });

        // Form validation feedback
        document.querySelectorAll('.form-input, .form-select, .form-textarea').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.hasAttribute('required') && !this.value.trim()) {
                    this.style.borderColor = '#dc3545';
                } else {
                    this.style.borderColor = '#e1e5e9';
                }
            });
        });
    </script>
</body>
</html>



